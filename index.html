<html>
<head>
  <title>Buzz </title>
  <script src="/js/socket.io.slim.js"></script>
  <script src="/js/jquery.js"></script>
  <!-- <script src="/js/jquery.js"></script> -->
  <link type="text/css" rel="stylesheet" href="/css/materialize.min.css"  media="screen,projection"/>
  <script src="/js/materialize.min.js"></script>
  <link type="text/css" rel="stylesheet" href="/css/main.css">
</head>

<body>
  <div class="container">
    <div class="row">
      <a href="#"><div id="buzzer" class="col s6 disabled button">Buzz</div></a>
      <a href="#"><div id="reset" class="col s6 button">reset</div></a>
    </div>  
    <div class="messages"><ul id="messages"></ul></div>
    <div class="divider"></div>
    <p><b>Connections:</b></p>
    <ul id="connections">
    </ul>
    <div class="divider"></div>
    <p><b>About QBBuzz:</b></p>
    <p id = "about">
      QBBuzz was built by Sky Li primarily for the Acton-Boxborough Quiz Bowl team. It allows users to connect to a synchronized buzzer online, helping to facilitate online practices. Players can name themselves, buzz, and see who buzzed. When a new player joins, the buzzer should be reset so that they can sync with everyone else. 

      QBBuzz was built with Node.JS using an Express framework for the server, socket.io for server-client communication, and MaterializeCSS for client UI. It is hosted on a free Heroku dyno.

      See the source code on GitHub <a href = "https://github.com/skyli42/Buzzer"> here</a>
    </p>
    <div id="modal1" class="modal">
      <div class="modal-content">
        <form id="name_form" >
          What is your name?
          <br />
          <input type="text" id="name" autocomplete = "off" autofocus="autofocus" onfocus="this.select()">
        </form>
      </div>
      <div class="modal-footer">
        <a href="#" id="submit_button" class="modal-action modal-close waves-effect waves-green btn-flat">Done</a>
      </div>
    </div>

  </div>
  <script>
    var socket = io();
    function sub(){socket.emit('new player', $('#name').val());}
    function updateConnections(array){
      $('#connections').empty();
      for(var i in array){
        $('#connections').append($('<li>').text(array[i]));
      }
    }
    socket.on('buzz', function(msg){
      $('#buzzer').addClass('disabled');
      $('#messages').prepend($('<li>').text(msg+" buzzed!"));
      var audio = new Audio('/media/buzz_sound.mp3');
      audio.play();
    });
    socket.on('reset', function(){
      $('#buzzer').removeClass('disabled');
      $('#messages').prepend($('<li>').text('reset!'));
      $('#messages').prepend('<div class="divider"></div>');
    });
    socket.on('new connection', function(msg){
      Materialize.toast(msg.id+" has connected!", 4000);
      updateConnections(msg.arr);
    })
    socket.on('disconnection', function(msg){
      Materialize.toast(msg.id+" has disconnected", 4000);
      updateConnections(msg.arr);
    })
    $('#reset').click(function(){socket.emit('reset')});
    $(document).ready(function(){
      $("#modal1").openModal({
        dismissible:false
      });
    });

    $("#submit_button").click(function(){sub();});
    $(document).keydown(function (event) {
      if (event.which == 13 || event.keyCode == 13) { 
        sub();
        $("#modal1").closeModal();
        return false;
      }
      else return true;
    }); 
    $('#buzzer').click(function(){
      if(!$('#buzzer').hasClass('disabled')){
        socket.emit('buzz', socket.id);
      }
    });
  </script>
</body>
</html>